// ==========================================================================
// Project:   Ember ListView
// Copyright: Â©2012-2013 Erik Bryn, Yapp Inc., and contributors.
// License:   Licensed under MIT license
// Version:   0.0.5
// ==========================================================================

(function(e){var t,i,n,r;(function(){var e;if(!Array.isArray){e=function(e){return Object.prototype.toString.call(e)==="[object Array]"}}else{e=Array.isArray}var s={},l={},o={};var h=false;t=function(t,i,n){if(!e(i)){n=i;i=[]}s[t]={deps:i,callback:n}};function a(e,t,i){var r=e.length;var s=new Array(r);var l;var o;for(var h=0,a=r;h<a;h++){l=e[h];if(l==="exports"){o=s[h]=i}else{s[h]=n(c(l,t))}}return{deps:s,exports:o}}r=n=i=function(e){if(o[e]!==h&&l.hasOwnProperty(e)){return l[e]}if(!s[e]){throw new Error("Could not find module "+e)}var t=s[e];var i;var n;var r=false;l[e]={};try{i=a(t.deps,e,l[e]);n=t.callback.apply(this,i.deps);r=true}finally{if(!r){o[e]=h}}return i.exports?l[e]:l[e]=n};function c(e,t){if(e.charAt(0)!=="."){return e}var i=e.split("/");var n=t.split("/");var r;if(n.length===1){r=n}else{r=n.slice(0,-1)}for(var s=0,l=i.length;s<l;s++){var o=i[s];if(o===".."){r.pop()}else if(o==="."){continue}else{r.push(o)}}return r.join("/")}r.entries=r._eak_seen=s;r.clear=function(){r.entries=r._eak_seen=s={};l=o={}}})();t("list-view/helper",["exports"],function(e){"use strict";e["default"]=function t(e){var t=e.hash;var i=e.hashTypes;t.content=t.items;delete t.items;i.content=i.items;delete i.items;if(!t.content){t.content="this";i.content="ID"}for(var n in t){if(/-/.test(n)){var r=Ember.String.camelize(n);t[r]=t[n];i[r]=i[n];delete t[n];delete i[n]}}return Ember.Handlebars.helpers.collection.call(this,"Ember.ListView",e)}});t("list-view/list_item_view",["list-view/list_item_view_mixin","exports"],function(e,t){"use strict";var i=e["default"];var n=Ember.get,r=Ember.set;var s=function(e){var t=[],i=e.childBuffers;Ember.ArrayPolyfills.forEach.call(i,function(e){var i=typeof e==="string";if(i){t.push(e)}else{e.array(t)}});return t.join("")};function l(e){if(e.willInsertElement){e.willInsertElement()}}function o(e){if(e.didInsertElement){e.didInsertElement()}}function h(){var e,t,i,h;e=n(this,"element");if(!e){return}i=n(this,"context");this.triggerRecursively("willClearRender");if(this.lengthAfterRender>this.lengthBeforeRender){this.clearRenderedChildren();this._childViews.length=this.lengthBeforeRender}if(i){t=Ember.RenderBuffer();t=this.renderToBuffer(t);h=this._childViews.length>0;if(h){this.invokeRecursively(l,false)}e.innerHTML=t.innerString?t.innerString():s(t);r(this,"element",e);var a=this._transitionTo?this._transitionTo:this.transitionTo;a.call(this,"inDOM");if(h){this.invokeRecursively(o,false)}}else{e.innerHTML=""}}var a=Ember.View.extend(i,{updateContext:function(e){var t=n(this,"context");Ember.instrument("view.updateContext.render",this,function(){if(t!==e){r(this,"context",e);if(e&&e.isController){r(this,"controller",e)}}},this)},rerender:function(){Ember.run.scheduleOnce("render",this,h)},_contextDidChange:Ember.observer(h,"context","controller")});t["default"]=a});t("list-view/list_item_view_mixin",["exports"],function(e){"use strict";var t=Ember.get,i=Ember.set;function n(e,t){return e&&t&&e.x===t.x&&e.y===t.y}function r(){var e,i,r;Ember.instrument("view.updateContext.positionElement",this,function(){e=t(this,"element");i=this.position;r=this._position;if(!i||!e){return}if(n(i,r)){return}Ember.run.schedule("render",this,this._parentView.applyTransform,e,i.x,i.y);this._position=i},this)}var s=Ember.Mixin.create({init:function(){this._super();this.one("didInsertElement",r)},classNames:["ember-list-item-view"],_position:null,updatePosition:function(e){this.position=e;this._positionElement()},_positionElement:r});e["default"]=s});t("list-view/list_view",["list-view/list_view_helper","list-view/list_view_mixin","exports"],function(e,t,i){"use strict";var n=e["default"];var r=t["default"];var s=Ember.get,l=Ember.set;var o=Ember.ContainerView.extend(r,{css:{position:"relative",overflow:"auto","-webkit-overflow-scrolling":"touch","overflow-scrolling":"touch"},applyTransform:n.applyTransform,_scrollTo:function(e){var t=s(this,"element");if(t){t.scrollTop=e}},didInsertElement:function(){var e=this;var t=s(this,"element");this._updateScrollableHeight();this._scroll=function(t){e.scroll(t)};Ember.$(t).on("scroll",this._scroll)},willDestroyElement:function(){var e;e=s(this,"element");Ember.$(e).off("scroll",this._scroll)},scroll:function(e){this.scrollTo(e.target.scrollTop)},scrollTo:function(e){var t=s(this,"element");this._scrollTo(e);this._scrollContentTo(e)},totalHeightDidChange:Ember.observer(function(){Ember.run.scheduleOnce("afterRender",this,this._updateScrollableHeight)},"totalHeight"),_updateScrollableHeight:function(){var e,t;t=this._state||this.state;if(t==="inDOM"){if(this._isChildEmptyView()){e=""}else{e=s(this,"totalHeight")}this.$(".ember-list-container").css({height:e})}}});i["default"]=o});t("list-view/list_view_helper",["exports"],function(e){"use strict";var t=document.createElement("div"),i=t.style;var n=["Webkit","Moz","O","ms"];function r(e){if(e in i)return e;var t=e.charAt(0).toUpperCase()+e.slice(1);for(var r=0;r<n.length;r++){var s=n[r]+t;if(s in i){return s}}return null}var s=r("transform");var l=r("perspective");var o=s!==null;var h=l!==null;var a={transformProp:s,applyTransform:function(){if(o){return function(e,t,i){e.style[s]="translate("+t+"px, "+i+"px)"}}else{return function(e,t,i){e.style.top=i+"px";e.style.left=t+"px"}}}(),apply3DTransform:function(){if(h){return function(e,t,i){e.style[s]="translate3d("+t+"px, "+i+"px, 0)"}}else if(o){return function(e,t,i){e.style[s]="translate("+t+"px, "+i+"px)"}}else{return function(e,t,i){e.style.top=i+"px";e.style.left=t+"px"}}}()};e["default"]=a});t("list-view/list_view_mixin",["list-view/reusable_list_item_view","exports"],function(e,t){"use strict";var i=e["default"];var n=Ember.get,r=Ember.set,s=Math.min,l=Math.max,o=Math.floor,h=Math.ceil,a=Ember.ArrayPolyfills.forEach;function c(){var e=n(this,"content");if(e){e.addArrayObserver(this)}}function u(e){this.removeObject(e);e.destroy()}function f(){Ember.run.once(this,"_syncChildViews")}function d(e,t){return n(e,"contentIndex")-n(t,"contentIndex")}function m(){if(Ember.View.notifyMutationListeners){Ember.run.once(Ember.View,"notifyMutationListeners")}}function v(){var e=n(this,"emptyView");if(e&&e instanceof Ember.View){e.removeFromParent()}}function p(){var e=n(this,"emptyView");if(!e){return}if("string"===typeof e){e=n(e)||e}e=this.createChildView(e);r(this,"emptyView",e);if(Ember.CoreView.detect(e)){this._createdEmptyView=e}this.unshiftObject(e)}var w=Ember.create(Ember.ContainerView.proto().domManager);w.prepend=function(e,t){e.$(".ember-list-container").prepend(t);m()};function g(){function e(e,t,i){console.time(e)}function t(e,t,i){console.timeEnd(e)}if(Ember.ENABLE_PROFILING){Ember.subscribe("view._scrollContentTo",{before:e,after:t});Ember.subscribe("view.updateContext",{before:e,after:t})}}var _=Ember.Mixin.create({itemViewClass:i,emptyViewClass:Ember.View,classNames:["ember-list-view"],attributeBindings:["style"],domManager:w,scrollTop:0,bottomPadding:0,_lastEndingIndex:0,paddingCount:1,init:function(){this._super();this.on("didInsertElement",this._syncListContainerWidth);this.columnCountDidChange();this._syncChildViews();this._addContentArrayObserver()},_addContentArrayObserver:Ember.beforeObserver(function(){c.call(this)},"content"),render:function(e){e.push('<div class="ember-list-container">');this._super(e);e.push("</div>")},willInsertElement:function(){if(!this.get("height")||!this.get("rowHeight")){throw new Error("A ListView must be created with a height and a rowHeight.")}this._super()},style:Ember.computed("height","width",function(){var e,t,i,r;e=n(this,"height");t=n(this,"width");r=n(this,"css");i="";if(e){i+="height:"+e+"px;"}if(t){i+="width:"+t+"px;"}for(var s in r){if(r.hasOwnProperty(s)){i+=s+":"+r[s]+";"}}return i}),scrollTo:function(e){throw new Error("must override to perform the visual scroll and effectively delegate to _scrollContentTo")},_scrollTo:Ember.K,_scrollContentTo:function(e){var t,i,r,o,h,a,c,u,f;u=l(0,e);if(this.scrollTop===u){return}var d=l(0,n(this,"totalHeight")-n(this,"height"));u=s(u,d);f=n(this,"content");c=n(f,"length");t=this._startingIndex(c);Ember.instrument("view._scrollContentTo",{scrollTop:u,content:f,startingIndex:t,endingIndex:s(l(c-1,0),t+this._numChildViewsForViewport())},function(){this.scrollTop=u;h=l(c-1,0);t=this._startingIndex();o=t+this._numChildViewsForViewport();i=s(h,o);if(t===this._lastStartingIndex&&i===this._lastEndingIndex){this.trigger("scrollYChanged",e);return}else{Ember.run(this,function(){this._reuseChildren();this._lastStartingIndex=t;this._lastEndingIndex=i;this.trigger("scrollYChanged",e)})}},this)},totalHeight:Ember.computed("content.length","rowHeight","columnCount","bottomPadding",function(){var e,t,i,r;e=n(this,"content.length");t=n(this,"rowHeight");i=n(this,"columnCount");r=n(this,"bottomPadding");return h(e/i)*t+r}),_prepareChildForReuse:function(e){e.prepareForReuse()},_reuseChildForContentIndex:function(e,t){var i,s,l,o,h,a;i=n(this,"content");a=n(this,"enableProfiling");h=this.positionForIndex(t);e.updatePosition(h);r(e,"contentIndex",t);if(a){Ember.instrument("view._reuseChildForContentIndex",h,function(){},this)}l=i.objectAt(t);e.updateContext(l)},positionForIndex:function(e){var t,i,r,s,l,h;t=n(this,"elementWidth")||1;i=n(this,"width")||1;r=n(this,"columnCount");s=n(this,"rowHeight");l=s*o(e/r);h=e%r*t;return{y:l,x:h}},_childViewCount:function(){var e,t;e=n(this,"content.length");t=this._numChildViewsForViewport();return s(e,t)},columnCount:Ember.computed("width","elementWidth",function(){var e,t,i;e=n(this,"elementWidth");t=n(this,"width");if(e&&t>e){i=o(t/e)}else{i=1}return i}),columnCountDidChange:Ember.observer(function(){var e,t,i,r,l,o,h,a;o=this._lastColumnCount;t=this.scrollTop;h=n(this,"columnCount");r=n(this,"maxScrollTop");a=n(this,"element");this._lastColumnCount=h;if(o){e=o/h;i=t*e;l=s(r,i);this._scrollTo(l);this.scrollTop=l}if(arguments.length>0){Ember.run.schedule("afterRender",this,this._syncListContainerWidth)}},"columnCount"),maxScrollTop:Ember.computed("height","totalHeight",function(){var e,t;e=n(this,"totalHeight");t=n(this,"height");return l(0,e-t)}),_isChildEmptyView:function(){var e=n(this,"emptyView");return e&&e instanceof Ember.View&&this._childViews.length===1&&this._childViews.indexOf(e)===0},_numChildViewsForViewport:function(){var e,t,i,r;e=n(this,"height");t=n(this,"rowHeight");i=n(this,"paddingCount");r=n(this,"columnCount");return h(e/t)*r+i*r},_startingIndex:function(e){var t,i,r,h,a;if(e===undefined){a=n(this,"content.length")}else{a=e}t=this.scrollTop;i=n(this,"rowHeight");r=n(this,"columnCount");h=o(t/i)*r;var c=this._numChildViewsForViewport();var u=1*r;var f=l(a-c,0);return s(h,f)},contentWillChange:Ember.beforeObserver(function(){var e;e=n(this,"content");if(e){e.removeArrayObserver(this)}},"content"),contentDidChange:Ember.observer(function(){c.call(this);f.call(this)},"content"),needsSyncChildViews:Ember.observer(f,"height","width","columnCount"),_addItemView:function(e){var t,i;t=n(this,"itemViewClass");i=this.createChildView(t);this.pushObject(i)},_syncChildViews:function(){var e,t,i,r,s,l,o,h,c,f,d;if(n(this,"isDestroyed")||n(this,"isDestroying")){return}h=n(this,"content.length");c=n(this,"emptyView");t=this._childViewCount();e=this.positionOrderedChildViews();if(this._isChildEmptyView()){v.call(this)}l=this._startingIndex();o=l+t;r=t;i=e.length;d=r-i;if(d===0){}else if(d>0){s=this._lastEndingIndex;for(f=0;f<d;f++,s++){this._addItemView(s)}}else{a.call(e.splice(r,i),u,this)}this._reuseChildren();this._lastStartingIndex=l;this._lastEndingIndex=this._lastEndingIndex+d;if(h===0||h===undefined){p.call(this)}},_syncListContainerWidth:function(){var e,t,i,r;e=n(this,"elementWidth");t=n(this,"columnCount");i=e*t;r=this.$(".ember-list-container");if(i&&r){r.css("width",i)}},_reuseChildren:function(){var e,t,i,r,o,h,a,c,u,f,d,m;m=this.scrollTop;e=n(this,"content.length");f=l(e-1,0);t=this.getReusableChildViews();i=t.length;r=this._startingIndex();u=r+this._numChildViewsForViewport();o=s(f,u);d=s(u,r+i);for(c=r;c<d;c++){h=t[c%i];this._reuseChildForContentIndex(h,c)}},getReusableChildViews:function(){return this._childViews},positionOrderedChildViews:function(){return this.getReusableChildViews().sort(d)},arrayWillChange:Ember.K,arrayDidChange:function(e,t,i,n){var r,s,l;v.call(this);l=this._state||this.state;if(l==="inDOM"){if(t>=this._lastStartingIndex||t<this._lastEndingIndex){r=0;a.call(this.positionOrderedChildViews(),function(e){s=this._lastStartingIndex+r;this._reuseChildForContentIndex(e,s);r++},this)}f.call(this)}},destroy:function(){if(!this._super()){return}if(this._createdEmptyView){this._createdEmptyView.destroy()}return this}});t["default"]=_});t("list-view/main",["list-view/reusable_list_item_view","list-view/virtual_list_view","list-view/list_item_view","list-view/helper","list-view/list_view","list-view/list_view_helper"],function(e,t,i,n,r,s){"use strict";var l=e["default"];var o=t["default"];var h=i["default"];var a=n["default"];var c=r["default"];var u=s["default"];Ember.ReusableListItemView=l;Ember.VirtualListView=o;Ember.ListItemView=h;Ember.ListView=c;Ember.ListViewHelper=u;Ember.Handlebars.registerHelper("ember-list",a)});t("list-view/reusable_list_item_view",["list-view/list_item_view_mixin","exports"],function(e,t){"use strict";var i=e["default"];var n=Ember.get,r=Ember.set;var s=Ember.View.extend(i,{init:function(){this._super();var e=Ember.ObjectProxy.create();this.set("context",e);this._proxyContext=e},isVisible:Ember.computed("context.content",function(){return!!this.get("context.content")}),updateContext:function(e){var t=n(this._proxyContext,"content"),i;i=this._state||this.state;if(t!==e){if(i==="inDOM"){this.prepareForReuse(e)}r(this._proxyContext,"content",e);if(e&&e.isController){r(this,"controller",e)}}},prepareForReuse:Ember.K});t["default"]=s});t("list-view/virtual_list_scroller_events",["exports"],function(e){"use strict";var t=/input|textarea|select/i,i="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,n,r,s,l,o,h,a,c;if(i){o="touchstart";n=function(e){var i=e.touches[0],n=i&&i.target;if(n&&t.test(n.tagName)){return}m(this.scrollerEventHandlers);this.willBeginScroll(e.touches,e.timeStamp);e.preventDefault()};h="touchmove";r=function(e){this.continueScroll(e.touches,e.timeStamp)};a="touchend";s=function(e){if(!this._isScrolling){g(e)}v(this.scrollerEventHandlers);this.endScroll(e.timeStamp)};c="touchcancel";l=function(e){v(this.scrollerEventHandlers);this.endScroll(e.timeStamp)}}else{o="mousedown";n=function(e){if(e.which!==1)return;var i=e.target;if(i&&t.test(i.tagName)){return}m(this.scrollerEventHandlers);this.willBeginScroll([e],e.timeStamp);e.preventDefault()};h="mousemove";r=function(e){this.continueScroll([e],e.timeStamp)};a="mouseup";s=function(e){v(this.scrollerEventHandlers);this.endScroll(e.timeStamp)};c="mouseout";l=function(e){if(e.relatedTarget)return;v(this.scrollerEventHandlers);this.endScroll(e.timeStamp)}}function u(e){this.mouseWheel(e);e.preventDefault()}function f(e,t){e.addEventListener(o,t.start,false);e.addEventListener("mousewheel",t.wheel,false)}function d(e,t){e.removeEventListener(o,t.start,false);e.removeEventListener("mousewheel",t.wheel,false)}function m(e){window.addEventListener(h,e.move,true);window.addEventListener(a,e.end,true);window.addEventListener(c,e.cancel,true)}function v(e){window.removeEventListener(h,e.move,true);window.removeEventListener(a,e.end,true);window.removeEventListener(c,e.cancel,true)}var p=Ember.Mixin.create({init:function(){this.on("didInsertElement",this,"bindScrollerEvents");this.on("willDestroyElement",this,"unbindScrollerEvents");this.scrollerEventHandlers={start:w(this,n),move:w(this,r),end:w(this,s),cancel:w(this,l),wheel:w(this,u)};return this._super()},scrollElement:Ember.computed.oneWay("element").readOnly(),bindScrollerEvents:function(){var e=this.get("scrollElement"),t=this.scrollerEventHandlers;f(e,t)},unbindScrollerEvents:function(){var e=this.get("scrollElement"),t=this.scrollerEventHandlers;d(e,t);v(t)}});function w(e,t){return function(i){t.call(e,i)}}function g(e){var i=e.changedTouches[0],n=i.target,r;if(n&&t.test(n.tagName)){r=document.createEvent("MouseEvents");r.initMouseEvent("click",true,true,e.view,1,i.screenX,i.screenY,i.clientX,i.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null);return n.dispatchEvent(r)}}e["default"]=p});t("list-view/virtual_list_view",["list-view/list_view_mixin","list-view/list_view_helper","list-view/virtual_list_scroller_events","exports"],function(e,t,i,n){"use strict";var r=e["default"];var s=t["default"];var l=i["default"];var o=Math.max,h=Ember.get,a=Ember.set;function c(e){var t,i,n;e=e||this;t=h(e,"width");i=h(e,"height");n=h(e,"totalHeight");e.scroller.setDimensions(t,i,t,n);e.trigger("scrollerDimensionsDidChange")}var u=Ember.ContainerView.extend(r,l,{_isScrolling:false,_mouseWheel:null,css:{position:"relative",overflow:"hidden"},init:function(){this._super();this.setupScroller();this.setupPullToRefresh()},_scrollerTop:0,applyTransform:s.apply3DTransform,setupScroller:function(){var e,t;e=this;e.scroller=new Scroller(function(t,i,n){var r=e._state||e.state;if(r!=="inDOM"){return}if(e.listContainerElement){e._scrollerTop=i;e._scrollContentTo(i);e.applyTransform(e.listContainerElement,0,-i)}},{scrollingX:false,scrollingComplete:function(){e.trigger("scrollingDidComplete")}});e.trigger("didInitializeScroller");c(e)},setupPullToRefresh:function(){if(!this.pullToRefreshViewClass){return}this._insertPullToRefreshView();this._activateScrollerPullToRefresh()},_insertPullToRefreshView:function(){this.pullToRefreshView=this.createChildView(this.pullToRefreshViewClass);this.insertAt(0,this.pullToRefreshView);var e=this;this.pullToRefreshView.on("didInsertElement",function(){Ember.run.schedule("afterRender",this,function(){e.applyTransform(this.get("element"),0,-1*e.pullToRefreshViewHeight)})})},_activateScrollerPullToRefresh:function(){var e=this;function t(){e.pullToRefreshView.set("active",true);e.trigger("activatePullToRefresh")}function i(){e.pullToRefreshView.set("active",false);e.trigger("deactivatePullToRefresh")}function n(){Ember.run(function(){e.pullToRefreshView.set("refreshing",true);function t(){if(e&&!e.get("isDestroyed")&&!e.get("isDestroying")){e.scroller.finishPullToRefresh();e.pullToRefreshView.set("refreshing",false)}}e.startRefresh(t)})}this.scroller.activatePullToRefresh(this.pullToRefreshViewHeight,t,i,n)},getReusableChildViews:function(){var e=this._childViews[0];if(e&&e===this.pullToRefreshView){return this._childViews.slice(1)}else{return this._childViews}},scrollerDimensionsNeedToChange:Ember.observer(function(){Ember.run.once(this,c)},"width","height","totalHeight"),didInsertElement:function(){this.listContainerElement=this.$("> .ember-list-container")[0]},willBeginScroll:function(e,t){this._isScrolling=false;this.trigger("scrollingDidStart");this.scroller.doTouchStart(e,t)},continueScroll:function(e,t){var i,n,r;if(this._isScrolling){this.scroller.doTouchMove(e,t)}else{i=this._scrollerTop;this.scroller.doTouchMove(e,t);n=this._scrollerTop;if(i!==n){r=Ember.$.Event("scrollerstart");Ember.$(e[0].target).trigger(r);this._isScrolling=true}}},endScroll:function(e){this.scroller.doTouchEnd(e)},scrollTo:function(e,t){if(t===undefined){t=true}this.scroller.scrollTo(0,e,t,1)},mouseWheel:function(e){var t,i,n;t=e.webkitDirectionInvertedFromDevice;i=e.wheelDeltaY*(t?.8:-.8);n=this.scroller.__scrollTop+i;if(n>=0&&n<=this.scroller.__maxScrollTop){this.scroller.scrollBy(0,i,true);e.stopPropagation()}return false}});n["default"]=u});i("list-view/main")})(this);