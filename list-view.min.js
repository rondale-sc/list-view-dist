// ==========================================================================
// Project:   Ember ListView
// Copyright: Â©2012-2013 Erik Bryn, Yapp Inc., and contributors.
// License:   Licensed under MIT license
// Version:   0.0.5
// ==========================================================================

(function(e){var t,i,r,n;(function(){var e;if(!Array.isArray){e=function(e){return Object.prototype.toString.call(e)==="[object Array]"}}else{e=Array.isArray}var s={},l={},o={};var h=false;t=function(t,i,r){if(!e(i)){r=i;i=[]}s[t]={deps:i,callback:r}};function a(e,t,i){var n=e.length;var s=new Array(n);var l;var o;for(var h=0,a=n;h<a;h++){l=e[h];if(l==="exports"){o=s[h]=i}else{s[h]=r(c(l,t))}}return{deps:s,exports:o}}n=r=i=function(e){if(o[e]!==h&&l.hasOwnProperty(e)){return l[e]}if(!s[e]){throw new Error("Could not find module "+e)}var t=s[e];var i;var r;var n=false;l[e]={};try{i=a(t.deps,e,l[e]);r=t.callback.apply(this,i.deps);n=true}finally{if(!n){o[e]=h}}return i.exports?l[e]:l[e]=r};function c(e,t){if(e.charAt(0)!=="."){return e}var i=e.split("/");var r=t.split("/");var n;if(r.length===1){n=r}else{n=r.slice(0,-1)}for(var s=0,l=i.length;s<l;s++){var o=i[s];if(o===".."){n.pop()}else if(o==="."){continue}else{n.push(o)}}return n.join("/")}n.entries=n._eak_seen=s;n.clear=function(){n.entries=n._eak_seen=s={};l=o={}}})();t("list-view/helper",["./list_view","./virtual_list_view","exports"],function(e,t,i){"use strict";var r=e["default"];var n=t["default"];function s(e,t){var i=t.hash;var r=t.hashTypes;i.content=i.items;delete i.items;r.content=r.items;delete r.items;if(!i.content){i.content="this";r.content="ID"}for(var n in i){if(/-/.test(n)){var s=Ember.String.camelize(n);i[s]=i[n];r[s]=r[n];delete i[n];delete r[n]}}return Ember.Handlebars.helpers.collection.call(this,e,t)}function l(e){return s.call(this,r,e)}i.EmberList=l;i["default"]=l;function o(e){return s.call(this,n,e)}i.EmberVirtualList=o});t("list-view/list_item_view",["list-view/list_item_view_mixin","exports"],function(e,t){"use strict";var i=e["default"];var r=Ember.get,n=Ember.set;t["default"]=Ember.View.extend(i,{updateContext:function(e){var t=r(this,"context");Ember.instrument("view.updateContext.render",this,function(){if(t!==e){n(this,"context",e);if(e&&e.isController){n(this,"controller",e)}}},this)},rerender:function(){if(this.isDestroying||this.isDestroyed){return}return this._super.apply(this,arguments)},_contextDidChange:Ember.observer(function(){Ember.run.once(this,this.rerender)},"context","controller")})});t("list-view/list_item_view_mixin",["exports"],function(e){"use strict";function t(e,t){return e&&t&&e.x===t.x&&e.y===t.y}function i(){var e,i,r;Ember.instrument("view.updateContext.positionElement",this,function(){e=this.element;i=this.position;r=this._position;if(!i||!e){return}if(t(i,r)){return}Ember.run.schedule("render",this,this._parentView.applyTransform,this,i.x,i.y);this._position=i},this)}e["default"]=Ember.Mixin.create({classNames:["ember-list-item-view"],style:"",attributeBindings:["style"],_position:null,_positionElement:i,positionElementWhenInserted:Ember.on("init",function(){this.one("didInsertElement",i)}),updatePosition:function(e){this.position=e;this._positionElement()}})});t("list-view/list_view",["list-view/list_view_helper","list-view/list_view_mixin","exports"],function(e,t,i){"use strict";var r=e["default"];var n=t["default"];var s=Ember.get;i["default"]=Ember.ContainerView.extend(n,{css:{position:"relative",overflow:"auto","-webkit-overflow-scrolling":"touch","overflow-scrolling":"touch"},applyTransform:r.applyTransform,_scrollTo:function(e){var t=this.element;if(t){t.scrollTop=e}},didInsertElement:function(){var e=this;this._updateScrollableHeight();this._scroll=function(t){e.scroll(t)};Ember.$(this.element).on("scroll",this._scroll)},willDestroyElement:function(){Ember.$(this.element).off("scroll",this._scroll)},scroll:function(e){this.scrollTo(e.target.scrollTop)},scrollTo:function(e){this._scrollTo(e);this._scrollContentTo(e)},totalHeightDidChange:Ember.observer(function(){Ember.run.scheduleOnce("afterRender",this,this._updateScrollableHeight)},"totalHeight"),_updateScrollableHeight:function(){var e,t;t=this._state||this.state;if(t==="inDOM"){if(this._isChildEmptyView()){e=""}else{e=s(this,"totalHeight")}this.$(".ember-list-container").css({height:e})}}})});t("list-view/list_view_helper",["exports"],function(e){"use strict";var t=document.body||document.createElement("div");var i=t.style;var r=Ember.set;function n(e){var t=e.charAt(0).toUpperCase()+e.slice(1);var r=[e,"webkit"+e,"webkit"+t,"Moz"+t,"moz"+t,"ms"+t,"ms"+e];for(var n=0;n<r.length;n++){var s=r[n];if(s in i){return s}}return null}function s(e){var t=n(e);var i=t.toLowerCase().replace(e,"");var r={webkit:"-webkit-"+e,moz:"-moz-"+e,ms:"-ms-"+e};if(i&&r[i]){return r[i]}return t}var l=n("transform");var o=s("transform");var h=n("perspective");var a=!!o;var c=!!h;function u(e){return function(t,i,n){var s=t instanceof Element;if(e&&(a||c)){var h=Ember.String.fmt(e,i,n);if(s){t.style[l]=h}else{r(t,"style",o+": "+h)}}else{if(s){t.style.top=n;t.style.left=i}}}}e["default"]={transformProp:o,applyTransform:function(){if(a){return u("translate(%@px, %@px)")}return u()}(),apply3DTransform:function(){if(c){return u("translate3d(%@px, %@px, 0)")}else if(a){return u("translate(%@px, %@px)")}return u()}()}});t("list-view/list_view_mixin",["list-view/reusable_list_item_view","exports"],function(e,t){"use strict";var i=e["default"];var r=Ember.get,n=Ember.set,s=Math.min,l=Math.max,o=Math.floor,h=Math.ceil,a=Ember.EnumerableUtils.forEach;function c(e,t){Error.call(this);this.message="Invalid "+e+": `"+t+"`";this.dimension=t}c.prototype=Object.create(Error.prototype);function u(e,t){if(t<=0||typeof t!=="number"||t!==t){throw new c(e,t)}return t}function d(e,t){if(arguments.length>1){var i;if(typeof t==="string"){i=parseInt(t,10)}else{i=t}Ember.meta(this).cache[e]=i;return i}else{return Ember.meta(this).cache[e]}}function f(){var e=r(this,"content");if(e){e.addArrayObserver(this)}}function m(e){this.removeObject(e);e.destroy()}function v(){Ember.run.once(this,"_syncChildViews")}function w(e,t){return r(e,"contentIndex")-r(t,"contentIndex")}function p(){var e=r(this,"emptyView");if(e&&e instanceof Ember.View){e.removeFromParent();if(this.totalHeightDidChange!==undefined){this.totalHeightDidChange()}}}function _(){var e=r(this,"emptyView");if(!e){return}if("string"===typeof e){e=r(e)||e}e=this.createChildView(e);n(this,"emptyView",e);if(Ember.CoreView.detect(e)){this._createdEmptyView=e}this.unshiftObject(e)}function g(){function e(e,t){console.time(e)}function t(e,t){console.timeEnd(e)}if(Ember.ENABLE_PROFILING){Ember.subscribe("view._scrollContentTo",{before:e,after:t});Ember.subscribe("view.updateContext",{before:e,after:t})}}t["default"]=Ember.Mixin.create({itemViewClass:i,emptyViewClass:Ember.View,classNames:["ember-list-view"],attributeBindings:["style"],classNameBindings:["_isGrid:ember-list-view-grid:ember-list-view-list","_isShelf:ember-list-view-shelf","_isFixed:ember-list-view-fixed"],scrollTop:0,bottomPadding:0,_lastEndingIndex:0,isShelf:false,isFixed:false,_isGrid:Ember.computed("width",function(){return this._bin.isGrid(this.get("width"))}).readOnly(),init:function(){this._super();this.set("width",this.get("width")||0);this._bin=this._setupBin();this._syncChildViews();this._addContentArrayObserver()},_setupBin:function(){if(this.heightForIndex){return this._setupShelfFirstBin()}else{return this._setupFixedGridBin()}},_setupShelfFirstBin:function(){n(this,"_isShelf",true);var e=new window.Bin.ShelfFirst([],this.get("width"),0);var t=this;e.length=function(){return t.get("content.length")};e.widthAtIndex=function(e){if(t.widthForIndex){return u("width",t.widthForIndex(e))}else{return Infinity}};e.heightAtIndex=function(e){return u("height",t.heightForIndex(e))};return e},_setupFixedGridBin:function(){n(this,"_isFixed",true);var e=new window.Bin.FixedGrid([],0,0);var t=this;e.length=function(){return t.get("content.length")};e.widthAtIndex=function(){var e=t.get("elementWidth");if(e===undefined){return e}return u("elementWidth",e)};e.heightAtIndex=function(){return u("rowHeight",t.get("rowHeight"))};return e},_addContentArrayObserver:Ember.beforeObserver(function(){f.call(this)},"content"),render:function(e){var t=e.element();var i=e.dom;var r=i.createElement("div");r.className="ember-list-container";t.appendChild(r);this._childViewsMorph=i.appendMorph(r,r);return r},height:Ember.computed(d),width:Ember.computed(d),rowHeight:Ember.computed(d),elementWidth:Ember.computed(d),style:Ember.computed("height","width",function(){var e,t,i,n;e=r(this,"height");t=r(this,"width");n=r(this,"css");i="";if(e){i+="height:"+e+"px;"}if(t){i+="width:"+t+"px;"}for(var s in n){if(n.hasOwnProperty(s)){i+=s+":"+n[s]+";"}}return i}),scrollTo:function(e){throw new Error("must override to perform the visual scroll and effectively delegate to _scrollContentTo")},_scrollTo:Ember.K,_scrollContentTo:function(e){var t,i,n,o,h,a,c,u,d;u=l(0,e);if(this.scrollTop===u){return}var f=l(0,r(this,"totalHeight")-r(this,"height"));u=s(u,f);d=r(this,"content");c=r(d,"length");this.scrollTop=u;t=this._startingIndex(c);Ember.instrument("view._scrollContentTo",{scrollTop:u,content:d,startingIndex:t,endingIndex:s(l(c-1,0),t+this._numChildViewsForViewport())},function(){h=l(c-1,0);t=this._startingIndex();o=t+this._numChildViewsForViewport();i=s(h,o);if(t===this._lastStartingIndex&&i===this._lastEndingIndex){this.trigger("scrollYChanged",e);return}else{Ember.run(this,function(){this._reuseChildren();this._lastStartingIndex=t;this._lastEndingIndex=i;this.trigger("scrollYChanged",e)})}},this)},_doElementDimensionChange:function(){this._bin.flush(0);Ember.propertyDidChange(this,"isGrid");Ember.run.once(this,this._syncChildViews)},_elementDimensionDidChange:Ember.beforeObserver("elementWidth","rowHeight","width","height",function(){this._doElementDimensionChange()}),totalHeight:Ember.computed("content.length","width","rowHeight","elementWidth","bottomPadding",function(){return this._bin.height(this.get("width"))+this.get("bottomPadding")}),_prepareChildForReuse:function(e){e.prepareForReuse()},createChildView:function(e){return this._super(e,this._itemViewProps||{})},_reuseChildForContentIndex:function(e,t){var i,s,l,o,h,a,c;var u=this.itemViewForIndex(t);if(e.constructor!==u){var d=this._childViews.indexOf(e);e.destroy();e=this.createChildView(u);this.insertAt(d,e)}i=r(this,"content");a=r(this,"enableProfiling");h=this.positionForIndex(t);e.updatePosition(h);n(e,"contentIndex",t);if(a){Ember.instrument("view._reuseChildForContentIndex",h,function(){},this)}l=i.objectAt(t);e.updateContext(l)},positionForIndex:function(e){if(this.get("content.length")===0){return{x:0,y:0}}return this._bin.position(e,this.get("width"))},_childViewCount:function(){var e,t;e=r(this,"content.length");t=this._numChildViewsForViewport();return s(e,t)},maxScrollTop:Ember.computed("height","totalHeight",function(){var e,t;e=r(this,"totalHeight");t=r(this,"height");return l(0,e-t)}),_isChildEmptyView:function(){var e=r(this,"emptyView");return e&&e instanceof Ember.View&&this._childViews.length===1&&this._childViews.indexOf(e)===0},_numChildViewsForViewport:function(){var e=r(this,"height");var t=r(this,"width");var i=this.get("scrollTop");var n=this._bin.numberVisibleWithin(i,t,e,true);return n},_startingIndex:function(e){var t,i,n,o;if(e===undefined){o=r(this,"content.length")}else{o=e}t=this.scrollTop;i=r(this,"rowHeight");n=this._bin.visibleStartingIndex(t,this.get("width"));var h=this._numChildViewsForViewport();var a=l(o-h,0);return s(n,a)},contentWillChange:Ember.beforeObserver(function(){var e=r(this,"content");if(e){e.removeArrayObserver(this)}},"content"),contentDidChange:Ember.observer(function(){this._bin.flush(0);f.call(this);v.call(this)},"content"),needsSyncChildViews:Ember.observer(v,"height","width","rowHeight","elementWidth"),_addItemView:function(e){var t,i;t=this.itemViewForIndex(e);i=this.createChildView(t);this.pushObject(i)},itemViewForIndex:function(e){return r(this,"itemViewClass")},heightForIndex:null,_syncScrollTop:function(){var e=this._numChildViewsForViewport();var t=this._oldNumberOfViewsNeededForViewport;if(t!==e){var i=r(this,"maxScrollTop");var n=this.scrollTop;var l=s(i,n*t/e);if(l===l){this._scrollTo(l);this.scrollTop=l}else{l=s(i,n);this._scrollTo(l);this.scrollTop=l}this._oldNumberOfViewsNeededForViewport=e}},_syncChildViews:function(){var e,t,i,n,s,l,o,h,c,u,d;if(this.isDestroyed||this.isDestroying){return}this._syncScrollTop();h=r(this,"content.length");c=r(this,"emptyView");t=this._childViewCount();e=this.positionOrderedChildViews();if(this._isChildEmptyView()){p.call(this)}l=this._startingIndex();o=l+t;n=t;i=e.length;d=n-i;if(d===0){}else if(d>0){s=this._lastEndingIndex;for(u=0;u<d;u++,s++){this._addItemView(s)}}else{a(e.splice(n,i),m,this)}this._reuseChildren();this._lastStartingIndex=l;this._lastEndingIndex=this._lastEndingIndex+d;if(h===0||h===undefined){_.call(this)}},_reuseChildren:function(){var e,t,i,n,o,h,a,c,u,d,f,m;m=this.scrollTop;e=r(this,"content.length");d=l(e-1,0);t=this.getReusableChildViews();i=t.length;n=this._startingIndex();u=n+this._numChildViewsForViewport();o=s(d,u);f=s(u,n+i);for(c=n;c<f;c++){h=t[c%i];this._reuseChildForContentIndex(h,c)}},getReusableChildViews:function(){return this._childViews},positionOrderedChildViews:function(){return this.getReusableChildViews().sort(w)},arrayWillChange:Ember.K,arrayDidChange:function(e,t,i,r){var n,s,l;if(this._isChildEmptyView()){p.call(this)}l=this._state||this.state;this._bin.flush(t);Ember.propertyDidChange(this,"isGrid");var o=this.get("content.length");if(l==="inDOM"){if(t>=this._lastStartingIndex||t<this._lastEndingIndex){n=0;a(this.positionOrderedChildViews(),function(e){s=this._lastStartingIndex+n;if(s<o){this._reuseChildForContentIndex(e,s)}n++},this)}v.call(this)}},destroy:function(){if(!this._super()){return}if(this._createdEmptyView){this._createdEmptyView.destroy()}return this}})});t("list-view/main",["list-view/reusable_list_item_view","list-view/virtual_list_view","list-view/list_item_view","list-view/helper","list-view/list_view","list-view/list_view_helper"],function(e,t,i,r,n,s){"use strict";var l=e["default"];var o=t["default"];var h=i["default"];var a=r.EmberList;var c=r.EmberVirtualList;var u=n["default"];var d=s["default"];Ember.ReusableListItemView=l;Ember.VirtualListView=o;Ember.ListItemView=h;Ember.ListView=u;Ember.ListViewHelper=d;Ember.Handlebars.registerHelper("ember-list",a);Ember.Handlebars.registerHelper("ember-virtual-list",c)});t("list-view/reusable_list_item_view",["list-view/list_item_view_mixin","exports"],function(e,t){"use strict";var i=e["default"];var r=Ember.get,n=Ember.set;t["default"]=Ember.View.extend(i,{prepareForReuse:Ember.K,init:function(){this._super();var e=Ember.ObjectProxy.create();this.set("context",e);this._proxyContext=e},isVisible:Ember.computed("context.content",function(){return!!this.get("context.content")}),updateContext:function(e){var t=r(this._proxyContext,"content");var i=this._state||this.state;if(t!==e){if(i==="inDOM"){this.prepareForReuse(e)}n(this._proxyContext,"content",e);if(e&&e.isController){n(this,"controller",e)}}}})});t("list-view/virtual_list_scroller_events",["exports"],function(e){"use strict";var t=/input|textarea|select/i,i="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,r,n,s,l,o,h,a,c;if(i){o="touchstart";r=function(e){var i=e.touches[0],r=i&&i.target;if(r&&t.test(r.tagName)){return}m(this.scrollerEventHandlers);this.willBeginScroll(e.touches,e.timeStamp);e.preventDefault()};h="touchmove";n=function(e){this.continueScroll(e.touches,e.timeStamp)};a="touchend";s=function(e){if(!this._isScrolling){p(e)}v(this.scrollerEventHandlers);this.endScroll(e.timeStamp)};c="touchcancel";l=function(e){v(this.scrollerEventHandlers);this.endScroll(e.timeStamp)}}else{o="mousedown";r=function(e){if(e.which!==1){return}var i=e.target;if(i&&t.test(i.tagName)){return}m(this.scrollerEventHandlers);this.willBeginScroll([e],e.timeStamp);e.preventDefault()};h="mousemove";n=function(e){this.continueScroll([e],e.timeStamp)};a="mouseup";s=function(e){v(this.scrollerEventHandlers);this.endScroll(e.timeStamp)};c="mouseout";l=function(e){if(e.relatedTarget){return}v(this.scrollerEventHandlers);this.endScroll(e.timeStamp)}}function u(e){this.mouseWheel(e);e.preventDefault()}function d(e,t){e.addEventListener(o,t.start,false);e.addEventListener("mousewheel",t.wheel,false)}function f(e,t){e.removeEventListener(o,t.start,false);e.removeEventListener("mousewheel",t.wheel,false)}function m(e){window.addEventListener(h,e.move,true);window.addEventListener(a,e.end,true);window.addEventListener(c,e.cancel,true)}function v(e){window.removeEventListener(h,e.move,true);window.removeEventListener(a,e.end,true);window.removeEventListener(c,e.cancel,true)}e["default"]=Ember.Mixin.create({init:function(){this.on("didInsertElement",this,"bindScrollerEvents");this.on("willDestroyElement",this,"unbindScrollerEvents");this.scrollerEventHandlers={start:w(this,r),move:w(this,n),end:w(this,s),cancel:w(this,l),wheel:w(this,u)};return this._super()},scrollElement:Ember.computed.oneWay("element").readOnly(),bindScrollerEvents:function(){var e=this.get("scrollElement"),t=this.scrollerEventHandlers;d(e,t)},unbindScrollerEvents:function(){var e=this.get("scrollElement"),t=this.scrollerEventHandlers;f(e,t);v(t)}});function w(e,t){return function(i){t.call(e,i)}}function p(e){var i=e.changedTouches[0],r=i.target,n;if(r&&!t.test(r.tagName)){n=document.createEvent("MouseEvents");n.initMouseEvent("click",true,true,e.view,1,i.screenX,i.screenY,i.clientX,i.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null);return r.dispatchEvent(n)}}});t("list-view/virtual_list_view",["list-view/list_view_mixin","list-view/list_view_helper","list-view/virtual_list_scroller_events","exports"],function(e,t,i,r){"use strict";var n=e["default"];var s=t["default"];var l=i["default"];var o=Ember.get;function h(e){var t,i,r;e=e||this;t=o(e,"width");i=o(e,"height");r=o(e,"totalHeight");e.scroller.setDimensions(t,i,t,r);e.trigger("scrollerDimensionsDidChange")}r["default"]=Ember.ContainerView.extend(n,l,{_isScrolling:false,_mouseWheel:null,css:{position:"relative",overflow:"hidden"},init:function(){this._super();this.setupScroller();this.setupPullToRefresh()},_scrollerTop:0,applyTransform:s.apply3DTransform,setupScroller:function(){var e=this;e.scroller=new Scroller(function(t,i){var r=e._state||e.state;if(r!=="inDOM"){return}if(e.listContainerElement){e._scrollerTop=i;e._scrollContentTo(i);e.applyTransform(e.listContainerElement,0,-i)}},{scrollingX:false,scrollingComplete:function(){e.trigger("scrollingDidComplete")}});e.trigger("didInitializeScroller");h(e)},setupPullToRefresh:function(){if(!this.pullToRefreshViewClass){return}this._insertPullToRefreshView();this._activateScrollerPullToRefresh()},_insertPullToRefreshView:function(){this.pullToRefreshView=this.createChildView(this.pullToRefreshViewClass);this.insertAt(0,this.pullToRefreshView);var e=this;this.pullToRefreshView.on("didInsertElement",function(){Ember.run.scheduleOnce("afterRender",this,function(){e.applyTransform(this.element,0,-1*e.pullToRefreshViewHeight)})})},_activateScrollerPullToRefresh:function(){var e=this;function t(){e.pullToRefreshView.set("active",true);e.trigger("activatePullToRefresh")}function i(){e.pullToRefreshView.set("active",false);e.trigger("deactivatePullToRefresh")}function r(){Ember.run(function(){e.pullToRefreshView.set("refreshing",true);function t(){if(e&&!e.get("isDestroyed")&&!e.get("isDestroying")){e.scroller.finishPullToRefresh();e.pullToRefreshView.set("refreshing",false)}}e.startRefresh(t)})}this.scroller.activatePullToRefresh(this.pullToRefreshViewHeight,t,i,r)},getReusableChildViews:function(){var e=this._childViews[0];if(e&&e===this.pullToRefreshView){return this._childViews.slice(1)}else{return this._childViews}},scrollerDimensionsNeedToChange:Ember.observer(function(){Ember.run.once(this,h)},"width","height","totalHeight"),didInsertElement:function(){this.listContainerElement=this.$("> .ember-list-container")[0]},willBeginScroll:function(e,t){this._isScrolling=false;this.trigger("scrollingDidStart");this.scroller.doTouchStart(e,t)},continueScroll:function(e,t){var i,r,n;if(this._isScrolling){this.scroller.doTouchMove(e,t)}else{i=this._scrollerTop;this.scroller.doTouchMove(e,t);r=this._scrollerTop;if(i!==r){n=Ember.$.Event("scrollerstart");Ember.$(e[0].target).trigger(n);this._isScrolling=true}}},endScroll:function(e){this.scroller.doTouchEnd(e)},scrollTo:function(e,t){if(t===undefined){t=true}this.scroller.scrollTo(0,e,t,1)},mouseWheel:function(e){var t,i,r;t=e.webkitDirectionInvertedFromDevice;i=e.wheelDeltaY*(t?.8:-.8);r=this.scroller.__scrollTop+i;if(r>=0&&r<=this.scroller.__maxScrollTop){this.scroller.scrollBy(0,i,true);e.stopPropagation()}return false}})});i("list-view/main")})(this);